<div id="admin_wrapper">
<div class="admin_subheader">
  <ul class="admin_list">
    <li><%= link_to "会社情報", "/company/details" %></li>
    <li class="admin_li_checked"><%= link_to "社員情報","/company/employees" %></li>
    <li><%= link_to "ギフト","/company/rewards" %></li>
    <li><%= link_to "ギフト申請一覧","/company/rewards/request" %></li>
    <li><%= link_to "特別ボーナス","/company/bonus" %></li>
    <li><%= link_to "Slack連携", "/integration/slack"%></li>
    <div class="clearfix"></div>
  </ul>
</div>

<div id="admin_contents" class="c_align">
  <h3>部署登録・編集</h3><br>
  <%= form_for @department , url: company_employees_create_department_and_team_by_csv_path(@department) , method: :post do |f| %>
    <%= f.file_field :upload_file %>
    <%= f.hidden_field :id %>
    <%= f.submit "送信する" %>
  <% end %><br/>

  <h3>社員登録・編集</h3><br>
  <a href="/company/employees/add" class="a_btncmn radius5">+ 社員を追加</a><br/><br/>
  <h4>CSVで追加する</h4>
  <%= form_for @user , url: company_employees_import_users_by_csv_path(@user) , method: :post do |f| %>
    <%= f.file_field :upload_file %>
    <%= f.hidden_field :id %>
    <%= f.submit "送信する" %>
  <% end %><br/>
  <p>社員登録用のフォーマットをダウンロードする</p><br/>
  <%= button_to 'ダウンロード', company_employees_export_csv_format_create_user_path(format: 'csv') %>

  <br><br>
<%if @team_exist == 0 %>
  <!-- team -->
  <div id="tab-container" class="tab-container">
  <p class="c_align">招待リンク: <a href="<%= @company[:invite_link] %>"><%= @company[:invite_link] %></a></p><br>
  <ul id="tab-menu" class="etabs">
    <% @teams.each do |team| %>
    <li class="tab">
      <a href="#<%= team[:team_id] %>" ><%= team[:team_name] %></a>
    </li>
    <% end %>
  </ul>
  <!-- team -->
  <% if flash[:notice] %><p class="c_align notice"><b><i><%= raw flash[:notice] %></i></b></p><br><% end %>
  <div class="toolbox">
    <% if @users.count == 0 %>
      <p><i>社員を追加してください</i></p><br>
    <% else %>
      <!-- team -->
      <% @teams.each do |team| %>
      <div id="<%= team[:team_id] %>">
      <table class="tbl_tools" border="1">
      	<%= render 'employees_th' %>
        <% team[:members].each do |item| %>
          <%= render 'employees_tr', item: item %>
        <% end %>
        </table>
      </div>
      <% end %>
    <!-- team -->
    <% end %>
    <p align="center">
      <input type="button" class="btn btn_back" style="width:80px;height:30px" value="戻る" />
    </p>
  <br>
</div> <!-- toolbox -->
</div> <!-- tabcontainer -->


<% else %>
  <% if flash[:notice] %><p class="c_align notice"><b><i><%= raw flash[:notice] %></i></b></p><br><% end %>
  <div class="toolbox">
    <p class="c_align">招待リンク: <a href="<%= @company[:invite_link] %>"><%= @company[:invite_link] %></a></p><br>
    <% if @users.count == 0 %>
      <p><i>社員を追加してください</i></p><br>
    <% else %>
      <table class="tbl_tools" border="1">
        <%= render 'employees_th' %>
  <% @users.each do | item | %>
    <%= render 'employees_tr', item: item %>
  <% end %>
      </table><br>
    <% end %>
    <p align="center">
      <input type="button" class="btn btn_back" style="width:80px;height:30px" value="戻る" />
    </p>
  </div><br>
</div>
<% end %>

</div> <!-- contents -->
</div> <!-- wrapper -->


<script type="text/javascript">
$('.chk_admin').change(function() {
  var _id = ($(this).attr('data-id')); //get attributes of clicked item

  if ($(this).is(":checked")) {
    if (confirm("管理者にしますか？")) {
      $.post("/company/employees/make_admin", { 'id': _id }); //send post request
    } else {
      $(this).prop("checked", false);
      return false; //do nothing
    }
  } else {
    if (confirm("本当に管理者から外しますか？")) {
      $.post("/company/employees/make_user", { 'id': _id }); //send post request
    } else {
      $(this).prop("checked", true);
      return false; //do nothing
    }
  }
});

$('.chk_manager').change(function() {
  var _id = ($(this).attr('data-id')); //get attributes of clicked item

  if ($(this).is(":checked")) {
    if (confirm("マネージャーにしますか？")) {
      $.post("/company/employees/make_manager", { 'id': _id }); //send post request
    } else {
      $(this).prop("checked", false);
      return false; //do nothing
    }
  } else {
    if (confirm("本当にマネージャーから外しますか？")) {
      $.post("/company/employees/make_non_manager", { 'id': _id }); //send post request
    } else {
      $(this).prop("checked", true);
      return false; //do nothing
    }
  }
});

$('.delete_item').click(function() {
  var _id = ($(this).attr('data-id')); //get attributes of clicked item

  if (confirm("本当に削除しますか？")) {
    $.post("/company/employees/delete", { 'id': _id }); //send post request
    $(".item_" + _id).remove(); //remove item upon deletion
  }
  return false; //do nothing
});

$(".btn_back").click(function() {
  window.location = "/company/details";
});
$('.setting_color').css('color','gray');

$(document).ready(function () {
  $("#tab-container").easytabs();
});

</script>
