<div id="admin_wrapper">
  <%= render "/company/admin_subheader" %>

  <div id="admin_contents">

<div class="admin_page_wrapper">
  <div class="blog_article_wrapper clearfix">
    <div class="blog_article_index float_left">
      <div class="blog_article_content">
        <% if @article.is_published == 0 %>
          <h2 class="color-red">※この記事は社員には公開されていません</h2>
        <% end %>
        <p class="blog_article_content_time"><%= @article.updated_at.strftime("%Y年%m月%d日") %></p>
        <h2 class="blog_article_content_title"><%= @article.title %></h2>
        <p class="blog_article_content_description"><%= @article.description %></p>
        <% @all_contents.each do |item| %>
          <% if item[:data_type] == "title" %>
            <div class="blog_article_content_head">
              <h3><%= item[:title] %></h3>
            </div>
          <% elsif item[:data_type] == "text" %>
            <div class="blog_article_content_text">
              <p><%= raw(item[:text].gsub(/\n/, '<br>'))  %></p>
            </div>
          <% elsif item[:data_type] == "link" %>
            <div class="blog_article_content_link">
              <%= link_to "#{item[:link_title]}", "#{:link_url}" %>
            </div>
          <% elsif item[:data_type] == "quotation" %>
            <div class="blog_article_content_quotation" >
              <p><%= item[:quotation_title] %></p>
            </div>
            <p class="text_refferal"><span>引用元：<%= link_to "#{item[:quotation_url]}", "#{item[:quotation_url]}", :target => "_blank" %></span></p>
          <% elsif item[:data_type] == "image" %>
            <div>
              <%= image_tag item[:img_src], class: "article_image", width: "300" %>
            </div>
          <% end %>
        <% end %>
        <div class="prizy_img">
          <% if @tags.present? && @tags.pluck(:tag_name).include?("Prizy") %>
            <%= link_to "https://www.prizy.me/" do %>
              <%= image_tag "https://s3-ap-northeast-1.amazonaws.com/dev-better-engage/banner_pc_02.png" %>
            <% end %>
          <% end %>
        </div>

          <div class="kudos">
            <% if @article.article_likes.select { |like| like.user_id == @user_id && like.is_liked == 0 }.count > 0 %>
              <a data-id="<%= @article.id %>" class="a_btn btn_unlike"><img src="https://s3-ap-northeast-1.amazonaws.com/btoa-img/common/btn_iine_on.png"/></a>
            <% else %>
              <a data-id="<%= @article.id %>" class="a_btn btn_like"><img src="https://s3-ap-northeast-1.amazonaws.com/btoa-img/common/btn_iine_off.png"/></a>
            <% end %>

            <span class="kudos_count"><%= @article.article_likes.where(is_liked: 1).count %>件</span>
          </div>


        <div class="article_tag_wrapper">
          <div class="article_tags">
            <p>この記事に含まれるタグ</p>
            <ul class="clearfix">
              <% @tags.each do |tag| %>
                <%= link_to "/blog/tag/#{tag.id}" do %>
                  <li class="margin-bottom-5"><span><%= tag.tag_name %></span></li>
                <% end %>
              <% end %>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
$(".btn_like").mouseup(function() {
  var article_id = ($(this).attr('data-id')); //get attributes of clicked item

  $.ajax({
    type: "POST",
    url: "/company/article/like",
    data: {article_id: article_id},
    success: function(data) {
      window.location.reload(); 
    }
  });
});

$(".btn_unlike").mouseup(function() {
  var article_id = ($(this).attr('data-id')); //get attributes of clicked item

  $.ajax({
    type: "POST",
    url: "/company/article/like",
    data: {'article_id': article_id},
    success: function(data) {
      window.location.reload(); 
    }
  });
});
</script>