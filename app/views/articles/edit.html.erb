<div id="admin_wrapper">
  <%= render "/company/admin_subheader" %>

	<div id="admin_contents" class="c_align">
	  <h3>ブログ</h3>
	  <div class="margin-10">
	    <%= link_to "+ 記事を作成する", company_article_new_path, {class: "a_btncmn radius5 width-250"} %>
	    <%= link_to "+ ニュース記事一覧", company_articles_path, {class: "a_btncmn radius5 width-250"} %>
	    <%= link_to "+ カジュアル記事一覧", company_casual_articles_path, {class: "a_btncmn radius5 width-250"} %>
	    <%= link_to "+ 社員からの投稿を見る", company_user_posted_contents_path, {class: "a_btncmn radius5 width-250"} %>
	  </div>
 
    <div class="margin-top-10">
	    <h3 class="margin-bottom-10">記事を編集する</h3>
	    <%= form_tag( "/company/article/#{@article.id}/update", method: "post", :multipart => true) do %>
	      <table class="article_table horizontal width-80-percent">
	        <tr>
	          <th class="width-20-percent">記事タイプ</th>
	          <td>
	            <% if @article.is_casual == 0 %>
  	            <input type="radio" name="is_casual" value="0" checked="checked">ニュース記事
	              <input type="radio" name="is_casual" value="1">カジュアル記事
	            <% else %>
  	            <input type="radio" name="is_casual" value="0">ニュース記事
	              <input type="radio" name="is_casual" value="1" checked="checked">カジュアル記事
	            <% end %>
	          </td>
	        </tr>
	        <tr>
            <th class="width-20-percent">タイトル</th>
	          <td><input name="title" class="width-100-percent" value="<%= @article.title %>"></td>
	        </tr>
	        <tr>
	          <th>ディスクリプション</th>
	          <td><textarea name="description" class="min-height-200 width-100-percent"><%= @article.description %></textarea></td>
	        </tr>
	        <tr>
	          <th>記事に登場する社員</th>
	          <td style="display: block;">
	            <input type="text" id="suggested_name" name="tags[]" value="" size="100" placeholder="メールアドレスを入力してください" />
	            <input type="button" value="追加" class="btn_change_password"/>
	            <div id="suggest" style="display:none;"></div>
	            <div id="adding_member">
                <% @article.tags.each do |tag| %>
                  <input type="text" name="tags[]" value="<%= tag.user.email %>" size="100"/><br>
                <% end %>
              </div>
	          </td>
	        </tr>
	        <tr>
	          <th>メニュー</th>
	          <td>
	            <ul class="clearfix">
	              <li class="title admin_menu c_align float_left margin-right-10">見出し</li>
	              <li class="text admin_menu c_align float_left margin-right-10">テキスト</li>
	              <li class="link admin_menu c_align float_left margin-right-10">リンク</li>
	              <li class="quotation admin_menu c_align float_left margin-right-10">引用</li>
	              <li class="image admin_menu c_align float_left">画像</li>
	            </ul>
	          </td>
	        </tr>
	        <% @all_contents.each do |item| %>
	          <tr>
	            <% if item[:data_type] == "title" %>
	              <th>タイトル<br><button type='button' class='delete_question'>削除する</button></th>
	              <td><input name="paragraph_titles[<%= @num %>]" class="width-100-percent" value="<%= item[:title] %>" /></td>
	            <% elsif item[:data_type] == "text" %>
	              <th>テキスト<br><button type='button' class='delete_question'>削除する</button></th>
	              <td><textarea name="texts[<%= @num %>]" class="width-100-percent height-200"><%= item[:text] %></textarea></td>
	            <% elsif item[:data_type] == "link" %>
	              <th>リンク<br><button type='button' class='delete_question'>削除する</button></th>
	              <td>
	                <input name="links[<%= @num %>][]" value="<%= item[:link_title] %>" class="width-100-percent"><br>
	                <input name="links[<%= @num %>][]" value="<%= item[:link_url] %>" class="width-100-percent">
	              </td>
	            <% elsif item[:data_type] == "quotation" %>
	              <th>引用<br><button type='button' class='delete_question'>削除する</button></th>
	              <td>
	                <input name="quotations[<%= @num %>][]" value="<%= item[:quotation_title] %>" class="width-100-percent"><br>
	                <input name="quotations[<%= @num %>][]" value="<%= item[:quotation_url] %>" class="width-100-percent">
	              </td>
	            <% elsif item[:data_type] == "image" %>
	              <th>画像</th>
	              <td>
                  <%= link_to "画像を変更・削除する", "/company/image/#{item[:id]}/edit" %><br>
                  <%= image_tag item[:image_url], class: "width-30-percent max-height-200 margin-10" %>
	              </td>
	            <% end %>
	          </tr>
	          <% @num = @num + 1 %>
	        <% end %>
	      </table>
        <input class="c_align submit-btn" type="submit" value="編集する">
	    <% end %>
	  </div>
	</div>
</div>

<script type="text/javascript">
var num = <%= @num %>;

$('.admin_menu').click(function(){
  num++;
  var _num = String(num);
  if ($(this).hasClass("title")) {
    var element = document.createElement('input');
    element.setAttribute("name", "paragraph_titles["+ _num +"]"); 
    element.setAttribute("type", "text");
    element.setAttribute("class", "width-100-percent");
    var _content = $([
      "<tr>",
        "<th>見出し<br><button type='button' class='delete_question'>削除する</button></th>",
        "<td class='insert_element'>",
        "</td>",
      "</tr>"].join(""));
    $(".article_table").append(_content);
    $(".insert_element").append(element);
    $(".insert_element").removeClass("insert_element");

  } else if ($(this).hasClass("text")) {
    var element = document.createElement('textarea');
    element.setAttribute("name", "texts["+ _num +"]"); 
    element.setAttribute("type", "text");
    element.setAttribute("class", "width-100-percent height-200");
    var _content = $([
      "<tr>",
        "<th>テキスト<br><button type='button' class='delete_question'>削除する</button></th>",
        "<td class='insert_element'>",
        "</td>",
      "</tr>"].join(""));
    $(".article_table").append(_content);
    $(".insert_element").append(element);
    $(".insert_element").removeClass("insert_element");

  } else if ($(this).hasClass("link")) {
    var title = document.createElement('input');
    title.setAttribute("name", "links["+ _num +"][]"); 
    title.setAttribute("type", "text");
    title.setAttribute("placeholder", "リンクタイトル");
    title.setAttribute("class", "width-100-percent");
    var url = document.createElement('input');
    url.setAttribute("name", "links["+ _num +"][]"); 
    url.setAttribute("type", "text");
    url.setAttribute("placeholder", "リンク先のURL");
    url.setAttribute("class", "width-100-percent");
    var _content = $([
      "<tr>",
        "<th>リンク<br><button type='button' class='delete_question'>削除する</button></th>",
        "<td class='insert_element'>",
        "</td>",
      "</tr>"].join(""));
    $(".article_table").append(_content);
    $(".insert_element").append(title);
    $(".insert_element").append('<br>');
    $(".insert_element").append(url);
    $(".insert_element").removeClass("insert_element");

  } else if ($(this).hasClass("quotation")) {
    var title = document.createElement('textarea');
    title.setAttribute("name", "quotations["+ _num +"][]"); 
    title.setAttribute("placeholder", "引用の内容");
    title.setAttribute("class", "width-100-percent height-200");
    var url = document.createElement('input');
    url.setAttribute("name", "quotations["+ _num +"][]"); 
    url.setAttribute("type", "text");
    url.setAttribute("placeholder", "引用元ののURL");
    url.setAttribute("class", "width-100-percent");
    var _content = $([
      "<tr>",
        "<th>引用<br><button type='button' class='delete_question'>削除する</button></th>",
        "<td class='insert_element'>",
        "</td>",
      "</tr>"].join(""));
    $(".article_table").append(_content);
    $(".insert_element").append(title);
    $(".insert_element").append('<br>');
    $(".insert_element").append(url);
    $(".insert_element").removeClass("insert_element");
  } else {
    var image = document.createElement('input');
    image.setAttribute("type", "file");
    image.setAttribute("multiple", "true");
    image.setAttribute("name", "images["+ _num +"]");
    image.setAttribute("required", "required");
    var _content = $([
      "<tr>",
        "<th>画像<br/><button type='button' class='delete_question'>削除する</button></th>",
        "<td class='insert_element'>",
        "</td>",
      "</tr>"].join(""));
    $(".article_table").append(_content);
    $(".insert_element").append(image);
    $(".insert_element").append('<br>');
    $(".insert_element").append(title);
    $(".insert_element").append('<br>');
    $(".insert_element").append(url);
    $(".insert_element").removeClass("insert_element");
  }
});

$('.article_table').on('click', '.delete_question', function(){
  $(this).parent().parent().remove();
});
$(".btn_change_password").click(function() {
  var addedname = $(':text[id="suggested_name"]').val();
  var element = document.createElement('input');
  element.setAttribute("name", "tags[]"); 
  element.setAttribute("value", addedname);
  element.setAttribute("type", "text");
  element.setAttribute("size", "100"); 
  element.setAttribute("style", "display:block;"); 
  $("#adding_member").append(element);
  $(':text[id="suggested_name"]').val("");
});

</script>